<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh Theo D√µi T·∫≠p Gym</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a90e2"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body>
    <main>
        <div id="auth-container" class="container">
            <div class="auth-header">
                <h1>üèãÔ∏è Gym Workout Tracker</h1>
            </div>
            <h2>Ch√†o m·ª´ng b·∫°n!</h2>
            <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªìng b·ªô d·ªØ li·ªáu t·∫≠p luy·ªán c·ªßa b·∫°n tr√™n m·ªçi thi·∫øt b·ªã.</p>
            <div class="auth-buttons">
                <button id="login-google-btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
                    <span>ƒêƒÉng nh·∫≠p v·ªõi Google</span>
                </button>
                <button id="login-email-btn">ƒêƒÉng nh·∫≠p v·ªõi Email</button>
            </div>
        </div>

        <div id="app-content" class="hidden">
            <div id="user-info" class="hidden" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <span id="user-display-name" style="font-weight: bold;"></span>
                <button id="logout-btn" class="btn btn-secondary">ƒêƒÉng xu·∫•t</button>
            </div>
            <main>
                <div class="main-grid">
                    <!-- Left Column -->
                    <div class="main-column">
                        <div class="workout-form-container card">
                            <h1>üìù Tr√¨nh theo d√µi t·∫≠p Gym</h1>
                    
                            <form id="workout-form">
                                <div class="form-group">
                                    <label for="workout-date">Ng√†y t·∫≠p</label>
                                    <input type="date" id="workout-date" required>
                                </div>

                                <div class="form-group">
                                    <label for="muscle-group">Nh√≥m c∆°</label>
                                    <select id="muscle-group" required>
                                        <option value="">-- Ch·ªçn nh√≥m c∆° --</option>
                                        <option value="Ng·ª±c">Ng·ª±c (Chest)</option>
                                        <option value="L∆∞ng">L∆∞ng (Back)</option>
                                        <option value="Ch√¢n">Ch√¢n (Legs)</option>
                                        <option value="Tay">Tay (Arms)</option>
                                        <option value="B·ª•ng">B·ª•ng (Abs)</option>
                                        <option value="Vai">Vai (Shoulders)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="exercise-name">T√™n b√†i t·∫≠p</label>
                                    <input type="text" id="exercise-name" placeholder="VD: Bench Press, Pull-up, Push-up..." required>
                                </div>

                                <div class="form-group">
                                    <label for="exercise-type">Lo·∫°i b√†i t·∫≠p</label>
                                    <select id="exercise-type" required>
                                        <option value="">-- Ch·ªçn lo·∫°i b√†i t·∫≠p --</option>
                                        <option value="weight">C√≥ t·∫° (Weight Training)</option>
                                        <option value="bodyweight">Kh√¥ng t·∫° (Bodyweight)</option>
                                        <option value="assisted">C√≥ h·ªó tr·ª£ kh·ªëi l∆∞·ª£ng (Assisted)</option>
                                    </select>
                                </div>

                                <div class="form-group" id="equipment-group">
                                    <label for="equipment">M√°y t·∫≠p / D·ª•ng c·ª•</label>
                                    <input type="text" id="equipment" placeholder="VD: T·∫° ƒë√≤n, X√† ƒë∆°n, M√°y h·ªó tr·ª£, D√¢y kh√°ng l·ª±c...">
                                </div>

                                <div class="sets-section">
                                    <div class="sets-header">
                                        <h3>Chi ti·∫øt c√°c Set</h3>
                                        <button type="button" id="add-set" class="btn btn-secondary">+ Th√™m Set</button>
                                    </div>
                                    <div id="sets-container">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="notes">Ghi ch√∫ th√™m</label>
                                    <textarea id="notes" placeholder="C·∫£m nh·∫≠n, k·ªπ thu·∫≠t..."></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">L∆∞u b√†i t·∫≠p</button>
                            </form>
                        </div>
                    </div>
                    <!-- Right Column -->
                    <div class="main-column">
                        <div class="card">
                            <h2>ü§ñ AI - Tr·ª£ L√Ω T·∫≠p Luy·ªán</h2>
                            <p class="description">M√¥ t·∫£ m·ª•c ti√™u c·ªßa b·∫°n, AI s·∫Ω t·∫°o m·ªôt bu·ªïi t·∫≠p t·ªëi ∆∞u d√†nh ri√™ng cho b·∫°n.</p>
                            <div class="ai-builder-form">
                                <textarea id="ai-workout-prompt" placeholder="V√≠ d·ª•: 'T·∫°o bu·ªïi t·∫≠p ch√¢n v√† b·ª•ng trong 90 ph√∫t, t·∫≠p trung v√†o s·ª©c m·∫°nh'"></textarea>
                                <button id="generate-ai-workout" class="btn btn-primary">T·∫°o Bu·ªïi T·∫≠p</button>
                            </div>
                        </div>
                        <div class="card">
                            <div id="history-table-container">
                                <div class="history-controls">
                                     <h2>L·ªãch s·ª≠ t·∫≠p luy·ªán</h2>
                                    <div class="data-controls">
                                        <button id="export-data" class="btn btn-success">üì§ Xu·∫•t d·ªØ li·ªáu</button>
                                        <input type="file" id="import-file" accept=".json" style="display: none;">
                                        <button id="import-data" class="btn btn-secondary">üì• Nh·∫≠p d·ªØ li·ªáu</button>
                                        <button id="delete-all" class="btn btn-danger">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                                    </div>
                                </div>
                                <div class="table-container">
                                    <table id="history-table">
                                        <thead>
                                            <tr>
                                                <th>Ng√†y</th>
                                                <th>Nh√≥m c∆°</th>
                                                <th>B√†i t·∫≠p</th>
                                                <th>D·ª•ng c·ª•</th>
                                                <th>Chi ti·∫øt Sets</th>
                                                <th>T·ªïng kh·ªëi l∆∞·ª£ng</th>
                                                <th>Ghi ch√∫</th>
                                                <th>Thao t√°c</th>
                                            </tr>
                                        </thead>
                                        <tbody id="history-body">
                                            </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>üìà Bi·ªÉu ƒë·ªì so s√°nh b√†i t·∫≠p</h2>
                    <div class="chart-controls">
                        <select id="chart-exercise">
                            <option value="">Ch·ªçn b√†i t·∫≠p</option>
                        </select>
                        <select id="chart-metric">
                            <option value="weight">M·ª©c t·∫° (kg)</option>
                            <option value="reps">S·ªë l·∫ßn l·∫∑p (reps)</option>
                            <option value="volume">T·ªïng kh·ªëi l∆∞·ª£ng (kg √ó reps)</option>
                        </select>
                        <select id="chart-period">
                            <option value="7">7 ng√†y g·∫ßn nh·∫•t</option>
                            <option value="30">30 ng√†y g·∫ßn nh·∫•t</option>
                            <option value="90">90 ng√†y g·∫ßn nh·∫•t</option>
                            <option value="all">T·∫•t c·∫£</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="progress-chart"></canvas>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>üìä Th·ªëng k√™ t·ªïng quan</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>T·ªïng kh·ªëi l∆∞·ª£ng (7 ng√†y qua)</h3>
                            <div id="total-volume" class="stat-value">0 kg</div>
                        </div>
                        <div class="stat-card">
                            <h3>T·ªïng s·ªë bu·ªïi t·∫≠p</h3>
                            <div id="total-workouts" class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>B√†i t·∫≠p ƒë∆∞·ª£c t·∫≠p nhi·ªÅu nh·∫•t</h3>
                            <div id="most-exercised" class="stat-value">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Nh√≥m c∆° t·∫≠p nhi·ªÅu nh·∫•t</h3>
                            <div id="most-muscle-group" class="stat-value">-</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>ü§ñ AI G·ª£i √ù Th√¥ng Minh</h2>
                    <div class="ai-controls">
                        <button id="refresh-ai" class="btn btn-primary">üîÑ C·∫≠p Nh·∫≠t G·ª£i √ù</button>
                        <select id="ai-filter">
                            <option value="all">T·∫•t c·∫£ g·ª£i √Ω</option>
                            <option value="high">∆Øu ti√™n cao</option>
                            <option value="medium">∆Øu ti√™n trung b√¨nh</option>
                            <option value="low">∆Øu ti√™n th·∫•p</option>
                        </select>
                    </div>
                    <div id="ai-recommendations" class="recommendations-container">
                        <p style="text-align: center; color: #666; font-style: italic;">ƒêang ph√¢n t√≠ch d·ªØ li·ªáu ƒë·ªÉ ƒë∆∞a ra g·ª£i √Ω...</p>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>üí™ Ho·∫°t ƒê·ªông & Ph·ª•c H·ªìi</h2>
                    <div class="activity-recovery-grid">
                        <div class="muscle-heatmap-container">
                            <h3>Heatmap Nh√≥m C∆°</h3>
                            <div class="muscle-maps">
                                <div class="muscle-map-view">
                                    <h4>Ph√≠a tr∆∞·ªõc</h4>
                                    <svg id="muscle-map-front" viewBox="0 0 200 400" preserveAspectRatio="xMidYMid meet">
                                        <!-- Body Outline -->
                                        <path d="M90,90 C80,90 80,80 80,70 C80,50 90,40 100,40 C110,40 120,50 120,70 C120,80 120,90 110,90 L90,90 Z" fill="#e0e0e0" stroke="#ccc" stroke-width="1"></path>
                                        <path d="M100,90 L100,200 L80,200 L80,380 L95,380 L95,300 L105,300 L105,380 L120,380 L120,200 Z" fill="none" stroke="#ccc" stroke-width="1"></path>
                                        
                                        <!-- Muscle Groups -->
                                        <rect id="muscle-chest" class="muscle-group" data-muscle="Ng·ª±c" x="82" y="105" width="36" height="35" rx="3" fill="#ccc"></rect>
                                        <rect id="muscle-abs" class="muscle-group" data-muscle="B·ª•ng" x="85" y="145" width="30" height="50" rx="3" fill="#ccc"></rect>
                                        <g class="muscle-group" data-muscle="Vai">
                                            <rect id="muscle-shoulders-left-front" x="65" y="95" width="20" height="25" rx="10" fill="#ccc"></rect>
                                            <rect id="muscle-shoulders-right-front" x="115" y="95" width="20" height="25" rx="10" fill="#ccc"></rect>
                                        </g>
                                        <g class="muscle-group" data-muscle="Tay">
                                            <rect id="muscle-arms-left-front" x="62" y="125" width="18" height="60" rx="8" fill="#ccc"></rect>
                                            <rect id="muscle-arms-right-front" x="120" y="125" width="18" height="60" rx="8" fill="#ccc"></rect>
                                        </g>
                                        <g class="muscle-group" data-muscle="Ch√¢n">
                                            <rect id="muscle-legs-left-front" x="80" y="200" width="18" height="90" rx="8" fill="#ccc"></rect>
                                            <rect id="muscle-legs-right-front" x="102" y="200" width="18" height="90" rx="8" fill="#ccc"></rect>
                                        </g>
                                    </svg>
                                </div>
                                <div class="muscle-map-view">
                                    <h4>Ph√≠a sau</h4>
                                    <svg id="muscle-map-back" viewBox="0 0 200 400" preserveAspectRatio="xMidYMid meet">
                                        <!-- Body Outline -->
                                        <path d="M90,90 C80,90 80,80 80,70 C80,50 90,40 100,40 C110,40 120,50 120,70 C120,80 120,90 110,90 L90,90 Z" fill="#e0e0e0" stroke="#ccc" stroke-width="1"></path>
                                        <path d="M100,90 L100,200 L80,200 L80,380 L95,380 L95,300 L105,300 L105,380 L120,380 L120,200 Z" fill="none" stroke="#ccc" stroke-width="1"></path>

                                        <!-- Muscle Groups -->
                                        <rect id="muscle-back" class="muscle-group" data-muscle="L∆∞ng" x="82" y="105" width="36" height="90" rx="3" fill="#ccc"></rect>
                                         <g class="muscle-group" data-muscle="Vai">
                                            <rect id="muscle-shoulders-left-back" x="65" y="95" width="20" height="25" rx="10" fill="#ccc"></rect>
                                            <rect id="muscle-shoulders-right-back" x="115" y="95" width="20" height="25" rx="10" fill="#ccc"></rect>
                                        </g>
                                        <g class="muscle-group" data-muscle="Tay">
                                            <rect id="muscle-arms-left-back" x="62" y="125" width="18" height="60" rx="8" fill="#ccc"></rect>
                                            <rect id="muscle-arms-right-back" x="120" y="125" width="18" height="60" rx="8" fill="#ccc"></rect>
                                        </g>
                                        <g class="muscle-group" data-muscle="Ch√¢n">
                                            <rect id="muscle-legs-left-back" x="80" y="200" width="18" height="90" rx="8" fill="#ccc"></rect>
                                            <rect id="muscle-legs-right-back" x="102" y="200" width="18" height="90" rx="8" fill="#ccc"></rect>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                            <div id="muscle-tooltip" class="muscle-tooltip" style="display:none;"></div>
                            <div class="heatmap-legend">
                                <div class="legend-item"><span class="color-box ready"></span>S·∫µn s√†ng t·∫≠p</div>
                                <div class="legend-item"><span class="color-box recovering"></span>ƒêang h·ªìi ph·ª•c</div>
                                <div class="legend-item"><span class="color-box sore"></span>C·∫ßn ngh·ªâ th√™m</div>
                            </div>
                        </div>
                        <div class="activity-calendar-container">
                            <h3>L·ªãch S·ª≠ T·∫≠p Luy·ªán (6 th√°ng qua)</h3>
                            <div id="activity-calendar" class="calendar">
                                <!-- Calendar will be generated here by JS -->
                                <div class="calendar-loading">ƒêang t·∫£i l·ªãch s·ª≠...</div>
                            </div>
                            <div class="calendar-legend">
                                <span>√çt</span>
                                <span class="color-box" style="background-color: #c6e48b;"></span>
                                <span class="color-box" style="background-color: #7bc96f;"></span>
                                <span class="color-box" style="background-color: #239a3b;"></span>
                                <span class="color-box" style="background-color: #196127;"></span>
                                <span>Nhi·ªÅu</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>üí™ ∆Ø·ªõc t√≠nh 1RM (One-Rep Max)</h2>
                    <div class="chart-controls">
                        <select id="rm-exercise">
                            <option value="">Ch·ªçn b√†i t·∫≠p</option>
                        </select>
                    </div>
                    <div id="rm-overview">
                        <p style="text-align: center; color: #666; font-style: italic;">Ch·ªçn m·ªôt b√†i t·∫≠p ƒë·ªÉ xem ∆∞·ªõc t√≠nh 1RM</p>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>üèÜ K·ª∑ L·ª•c C√° Nh√¢n (PRs)</h2>
                    <div id="pr-list" class="pr-list-container">
                        <p style="text-align: center; color: #666;">Ch∆∞a c√≥ k·ª∑ l·ª•c n√†o ƒë∆∞·ª£c ghi nh·∫≠n. H√£y t·∫≠p luy·ªán v√† ph√° v·ª° gi·ªõi h·∫°n!</p>
                    </div>
                </div>

                <div class="chart-section">
                    <h2>‚ö°Ô∏è Qu·∫£n L√Ω D·ªØ Li·ªáu</h2>
                    <div class="data-management-grid">
                        <button id="delete-all" class="btn btn-danger">X√≥a To√†n B·ªô D·ªØ Li·ªáu</button>
                    </div>
                </div>
            </main>

            <!-- Edit Modal -->
            <div id="edit-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>‚úèÔ∏è Ch·ªânh s·ª≠a b√†i t·∫≠p</h2>
                        <span class="close">&times;</span>
                    </div>
                    <form id="edit-form">
                        <input type="hidden" id="edit-id">
                        <div class="form-group">
                            <label for="edit-workout-date">Ng√†y t·∫≠p</label>
                            <input type="date" id="edit-workout-date" required>
                        </div>

                        <div class="form-group">
                            <label for="edit-muscle-group">Nh√≥m c∆°</label>
                            <select id="edit-muscle-group" required>
                                <option value="">-- Ch·ªçn nh√≥m c∆° --</option>
                                <option value="Ng·ª±c">Ng·ª±c (Chest)</option>
                                <option value="L∆∞ng">L∆∞ng (Back)</option>
                                <option value="Ch√¢n">Ch√¢n (Legs)</option>
                                <option value="Tay">Tay (Arms)</option>
                                <option value="B·ª•ng">B·ª•ng (Abs)</option>
                                <option value="Vai">Vai (Shoulders)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="edit-exercise-name">T√™n b√†i t·∫≠p</label>
                            <input type="text" id="edit-exercise-name" placeholder="VD: Bench Press, Pull-up, Push-up..." required>
                        </div>

                        <div class="form-group">
                            <label for="edit-exercise-type">Lo·∫°i b√†i t·∫≠p</label>
                            <select id="edit-exercise-type" required>
                                <option value="">-- Ch·ªçn lo·∫°i b√†i t·∫≠p --</option>
                                <option value="weight">C√≥ t·∫° (Weight Training)</option>
                                <option value="bodyweight">Kh√¥ng t·∫° (Bodyweight)</option>
                                <option value="assisted">C√≥ h·ªó tr·ª£ kh·ªëi l∆∞·ª£ng (Assisted)</option>
                            </select>
                        </div>

                        <div class="form-group" id="edit-equipment-group">
                            <label for="edit-equipment">M√°y t·∫≠p / D·ª•ng c·ª•</label>
                            <input type="text" id="edit-equipment" placeholder="VD: T·∫° ƒë√≤n, X√† ƒë∆°n, M√°y h·ªó tr·ª£, D√¢y kh√°ng l·ª±c...">
                        </div>

                        <div class="sets-section">
                            <div class="sets-header">
                                <h3>Chi ti·∫øt c√°c Set</h3>
                                <button type="button" id="edit-add-set" class="btn btn-secondary">+ Th√™m Set</button>
                            </div>
                            <div id="edit-sets-container">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="edit-notes">Ghi ch√∫ th√™m</label>
                            <textarea id="edit-notes" placeholder="C·∫£m nh·∫≠n, k·ªπ thu·∫≠t..."></textarea>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">L∆∞u thay ƒë·ªïi</button>
                            <button type="button" id="cancel-edit" class="btn btn-secondary">H·ªßy b·ªè</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- AI Workout Plan Modal -->
        <div id="ai-plan-modal" class="modal" style="display:none;">
            <div class="modal-content ai-plan-modal-content">
                <span id="close-ai-plan-modal" class="close-btn">&times;</span>
                <div id="ai-plan-container">
                    <!-- Plan will be generated here -->
                </div>
            </div>
        </div>

        <!-- PR Celebration Modal -->
        <div id="pr-modal" class="modal" style="display:none;">
            <div class="modal-content pr-modal-content">
                <span id="close-pr-modal" class="close-btn">&times;</span>
                <div class="pr-celebration">
                    <!-- Confetti will be added dynamically by JS -->
                    <h2>üéâ PR M·ªöI! üéâ</h2>
                    <p>Ch√∫c m·ª´ng b·∫°n ƒë√£ ph√° k·ª∑ l·ª•c c√° nh√¢n!</p>
                    <div id="pr-details-container" class="pr-details-container">
                        <!-- PR details will be inserted here by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Result Modal -->
        <div id="ai-result-modal" class="ai-modal" style="display:none;">
            <div class="ai-modal-content">
                <button id="ai-modal-close" class="ai-modal-close">√ó</button>
                <div id="ai-result-html"></div>
            </div>
        </div>
    </main>

    <!-- Auth Modal for Email/Password -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-auth-modal">&times;</span>
            <h2 id="auth-modal-title">ƒêƒÉng nh·∫≠p</h2>
            <form id="auth-form">
                <input type="email" id="auth-email" placeholder="Email" required>
                <input type="password" id="auth-password" placeholder="M·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" required>
                <p id="auth-error" class="error-text"></p>
                <div id="auth-actions">
                    <button type="submit" id="auth-submit-btn">ƒêƒÉng nh·∫≠p</button>
                    <a href="#" id="auth-toggle-link">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="app.js?v=3" defer></script>
</body>
</html>