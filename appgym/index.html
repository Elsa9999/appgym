<head>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- Meta tags cho social sharing -->
  <meta property="og:title" content="AppGym - Theo dÃµi táº­p luyá»‡n thÃ´ng minh">
  <meta property="og:description" content="á»¨ng dá»¥ng theo dÃµi táº­p luyá»‡n vá»›i AI phÃ¢n tÃ­ch vÃ  Ä‘á»“ng bá»™ Ä‘a thiáº¿t bá»‹">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    const firebaseConfig = {
      apiKey: "AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
      authDomain: "appgym-tracker.firebaseapp.com",
      projectId: "appgym-tracker",
      storageBucket: "appgym-tracker.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef123456"
    };
    
    const app = initializeApp(firebaseConfig);
    window.auth = getAuth(app);
    window.db = getFirestore(app);
    
    onAuthStateChanged(auth, (user) => {
      window.currentUser = user;
      updateAuthUI();
    });
    
    function updateAuthUI() {
      const authSection = document.getElementById('auth-section');
      const userInfo = document.getElementById('user-info');
      const loginForm = document.getElementById('login-form');
      
      if (currentUser) {
        authSection.style.display = 'none';
        userInfo.style.display = 'block';
        userInfo.innerHTML = `
          <div style="text-align:center;padding:16px;background:var(--card-bg);border-radius:8px;margin-bottom:16px;">
            <b>ÄÃ£ Ä‘Äƒng nháº­p:</b> ${currentUser.email}<br>
            <button onclick="signOut(auth)" style="margin-top:8px;padding:4px 12px;">ÄÄƒng xuáº¥t</button>
          </div>
        `;
      } else {
        authSection.style.display = 'block';
        userInfo.style.display = 'none';
      }
    }
    
    window.loginUser = async (email, password) => {
      try {
        await signInWithEmailAndPassword(auth, email, password);
        return { success: true };
      } catch (error) {
        return { success: false, error: error.message };
      }
    };
    
    window.registerUser = async (email, password) => {
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        return { success: true };
      } catch (error) {
        return { success: false, error: error.message };
      }
    };
  </script>
</head>

<!-- Header vá»›i toggle dark mode -->
<header style="position:sticky;top:0;z-index:100;background:var(--header-bg);padding:16px;box-shadow:0 2px 8px var(--shadow);">
  <div style="display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;">
    <h1 style="margin:0;color:var(--text-primary);">ğŸ‹ï¸ AppGym</h1>
    <button id="dark-mode-toggle" style="background:var(--accent);color:var(--text-on-accent);border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:1.2rem;">ğŸŒ™</button>
  </div>
</header>

<div id="user-info" style="display:none;"></div>

<section id="auth-section" style="margin:32px 0;">
  <h2 style="text-align:center;">ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
  <div style="max-width:400px;margin:0 auto;">
    <form id="login-form" style="display:flex;flex-direction:column;gap:12px;">
      <input id="auth-email" type="email" placeholder="Email" required style="padding:8px;border-radius:4px;border:1px solid #ccc;">
      <input id="auth-password" type="password" placeholder="Máº­t kháº©u" required style="padding:8px;border-radius:4px;border:1px solid #ccc;">
      <button type="submit" style="padding:10px;background:#1976d2;color:#fff;border:none;border-radius:4px;cursor:pointer;">ÄÄƒng nháº­p</button>
      <button type="button" id="register-btn" style="padding:10px;background:#43a047;color:#fff;border:none;border-radius:4px;cursor:pointer;">ÄÄƒng kÃ½</button>
      <div id="auth-feedback" style="text-align:center;font-weight:bold;"></div>
    </form>
  </div>
</section>

<div id="exercise-3d-viewer" style="margin: 16px 0;"></div>

<!-- BÃ¡o cÃ¡o nÃ¢ng cao & Biá»ƒu Ä‘á»“ trá»±c quan -->
<section id="report-section" style="margin:32px 0;">
  <h2 style="text-align:center;">BÃ¡o cÃ¡o táº­p luyá»‡n & Biá»ƒu Ä‘á»“ trá»±c quan</h2>
  <div style="display:flex;flex-wrap:wrap;gap:32px;justify-content:center;">
    <div style="flex:1;min-width:320px;max-width:480px;">
      <h3 style="text-align:center;">Khá»‘i lÆ°á»£ng táº­p theo nhÃ³m cÆ¡</h3>
      <canvas id="muscleVolumeChart" height="240"></canvas>
    </div>
    <div style="flex:1;min-width:320px;max-width:480px;">
      <h3 style="text-align:center;">Sá»‘ buá»•i táº­p theo thá»i gian</h3>
      <canvas id="workoutCountChart" height="240"></canvas>
    </div>
  </div>
</section>

<section id="inbody-section" style="margin:32px 0;">
  <h2 style="text-align:center;">PhÃ¢n tÃ­ch InBody báº±ng AI</h2>
  <div style="max-width:600px;margin:0 auto;">
    <label for="inbody-analysis-input">DÃ¡n káº¿t quáº£ phÃ¢n tÃ­ch InBody tá»« AI (ChatGPT...)</label>
    <textarea id="inbody-analysis-input" rows="6" style="width:100%;margin:8px 0 16px 0;"></textarea>
    <button id="save-inbody-btn" style="padding:8px 24px;">LÆ°u káº¿t quáº£ InBody</button>
    <div id="inbody-feedback" style="margin:12px 0;color:green;"></div>
    <div id="inbody-compare" style="margin-top:24px;"></div>
  </div>
</section>

<section id="profile-section" style="margin:32px 0;">
  <h2 style="text-align:center;">ThÃ´ng tin cÃ¡ nhÃ¢n</h2>
  <form id="profile-form" style="max-width:480px;margin:0 auto;display:flex;flex-wrap:wrap;gap:16px;">
    <input id="profile-height" type="number" step="0.1" placeholder="Chiá»u cao (cm)" style="flex:1;min-width:120px;">
    <input id="profile-weight" type="number" step="0.1" placeholder="CÃ¢n náº·ng (kg)" style="flex:1;min-width:120px;">
    <input id="profile-age" type="number" step="1" placeholder="Tuá»•i" style="flex:1;min-width:80px;">
    <input id="profile-tdee" type="number" step="1" placeholder="TDEE (kcal)" style="flex:1;min-width:120px;">
    <input id="profile-goal" type="text" placeholder="Má»¥c tiÃªu (vÃ­ dá»¥: tÄƒng cÆ¡, giáº£m má»¡...)" style="flex:2;min-width:180px;">
    <button type="submit" style="padding:8px 24px;">LÆ°u thÃ´ng tin</button>
    <span id="profile-feedback" style="margin-left:12px;color:green;"></span>
  </form>
</section>

<section id="inbody-progress-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Biá»ƒu Ä‘á»“ tiáº¿n trÃ¬nh InBody</h2>
  <div style="max-width:700px;margin:0 auto;">
    <canvas id="inbodyProgressChart" height="280"></canvas>
  </div>
</section>

<section id="export-history-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Lá»‹ch sá»­ xuáº¥t dá»¯ liá»‡u cho AI</h2>
  <div id="export-history-list" style="max-width:700px;margin:0 auto;"></div>
</section>

<section id="export-ai-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Xuáº¥t dá»¯ liá»‡u cho AI</h2>
  <div style="text-align:center;">
    <button id="export-ai-btn" style="padding:10px 32px;font-size:1.1rem;">Xuáº¥t dá»¯ liá»‡u cho AI</button>
  </div>
  <div id="export-ai-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:2000;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:32px 24px;border-radius:16px;max-width:700px;width:90vw;max-height:90vh;overflow:auto;box-shadow:0 8px 32px #0005;position:relative;">
      <button id="close-export-ai" style="position:absolute;top:12px;right:16px;font-size:1.5rem;background:none;border:none;cursor:pointer;">&times;</button>
      <h3 style="text-align:center;">Copy toÃ n bá»™ dá»¯ liá»‡u dÆ°á»›i Ä‘Ã¢y vÃ  dÃ¡n vÃ o ChatGPT hoáº·c AI máº¡nh Ä‘á»ƒ nháº­n lá»™ trÃ¬nh, Ä‘á»™ng viÃªn!</h3>
      <label for="export-ai-prompt" style="font-weight:bold;">Prompt AI (cÃ³ thá»ƒ chá»‰nh sá»­a):</label>
      <textarea id="export-ai-prompt" rows="2" style="width:100%;margin:8px 0 8px 0;font-size:1rem;padding:8px;border-radius:8px;background:#f0f4fa;">Báº¡n lÃ  huáº¥n luyá»‡n viÃªn AI, hÃ£y phÃ¢n tÃ­ch dá»¯ liá»‡u dÆ°á»›i Ä‘Ã¢y vÃ  Ä‘Æ°a ra lá»™ trÃ¬nh táº­p luyá»‡n, dinh dÆ°á»¡ng, Ä‘á»™ng viÃªn phÃ¹ há»£p nháº¥t cho tÃ´i. Náº¿u thiáº¿u thÃ´ng tin nÃ o, hÃ£y há»i láº¡i hoáº·c Ä‘Æ°a ra lá»i khuyÃªn phÃ¹ há»£p.</textarea>
      <textarea id="export-ai-textarea" rows="18" style="width:100%;margin:8px 0 8px 0;font-size:1rem;padding:12px;border-radius:8px;background:#f8f9fa;"></textarea>
      <button id="copy-export-ai" style="padding:8px 24px;">Copy</button>
      <span id="export-ai-copied" style="margin-left:16px;color:green;display:none;">ÄÃ£ copy!</span>
    </div>
  </div>
</section>

<section id="social-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Chia sáº» thÃ nh tÃ­ch</h2>
  <div style="max-width:600px;margin:0 auto;text-align:center;">
    <div id="achievement-card" style="background:var(--card-bg);border-radius:16px;padding:24px;margin-bottom:16px;box-shadow:var(--card-shadow);">
      <h3>ğŸ‰ ThÃ nh tÃ­ch cá»§a báº¡n</h3>
      <div id="achievement-stats" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:16px;margin:16px 0;">
        <div style="text-align:center;">
          <div style="font-size:2rem;font-weight:bold;color:var(--accent);">0</div>
          <div style="font-size:0.9rem;color:var(--text-secondary);">Buá»•i táº­p</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:2rem;font-weight:bold;color:var(--accent);">0</div>
          <div style="font-size:0.9rem;color:var(--text-secondary);">NgÃ y streak</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:2rem;font-weight:bold;color:var(--accent);">0</div>
          <div style="font-size:0.9rem;color:var(--text-secondary);">Kg giáº£m</div>
        </div>
      </div>
      <button id="generate-share-card" style="background:var(--accent);color:var(--text-on-accent);border:none;border-radius:8px;padding:12px 24px;cursor:pointer;margin:8px;">Táº¡o card chia sáº»</button>
    </div>
    <div id="share-buttons" style="display:none;">
      <h4>Chia sáº» lÃªn:</h4>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
        <button onclick="shareToFacebook()" style="background:#1877f2;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;">Facebook</button>
        <button onclick="shareToTwitter()" style="background:#1da1f2;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;">Twitter</button>
        <button onclick="shareToWhatsApp()" style="background:#25d366;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;">WhatsApp</button>
        <button onclick="copyShareLink()" style="background:var(--accent);color:var(--text-on-accent);border:none;border-radius:8px;padding:8px 16px;cursor:pointer;">Copy Link</button>
      </div>
    </div>
  </div>
</section>

<section id="advanced-charts-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Biá»ƒu Ä‘á»“ phÃ¢n tÃ­ch nÃ¢ng cao</h2>
  <div style="display:flex;flex-wrap:wrap;gap:32px;justify-content:center;">
    <div style="flex:1;min-width:320px;max-width:480px;">
      <h3 style="text-align:center;">CÃ¢n báº±ng nhÃ³m cÆ¡ (Radar)</h3>
      <canvas id="muscleBalanceChart" height="280"></canvas>
    </div>
    <div style="flex:1;min-width:320px;max-width:480px;">
      <h3 style="text-align:center;">Volume theo thá»i gian (Bubble)</h3>
      <canvas id="volumeTimeChart" height="280"></canvas>
    </div>
  </div>
  <div style="max-width:700px;margin:32px auto;">
    <h3 style="text-align:center;">PhÃ¢n tÃ­ch xu hÆ°á»›ng</h3>
    <canvas id="trendAnalysisChart" height="300"></canvas>
  </div>
</section>

<section id="export-data-section" style="margin:32px 0;">
  <h2 style="text-align:center;">Xuáº¥t dá»¯ liá»‡u</h2>
  <div style="max-width:600px;margin:0 auto;text-align:center;">
    <div style="display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin-bottom:24px;">
      <button id="export-csv-btn" style="background:#4caf50;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;">
        ğŸ“Š Xuáº¥t CSV
      </button>
      <button id="export-json-btn" style="background:#ff9800;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;">
        ğŸ“„ Xuáº¥t JSON
      </button>
      <button id="export-pdf-btn" style="background:#f44336;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;">
        ğŸ“‹ Xuáº¥t PDF
      </button>
    </div>
    <div id="export-options" style="background:var(--card-bg);border-radius:12px;padding:20px;margin-top:16px;">
      <h4>TÃ¹y chá»n xuáº¥t:</h4>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:16px 0;">
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" id="export-workouts" checked> Buá»•i táº­p
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" id="export-inbody" checked> InBody
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" id="export-profile" checked> ThÃ´ng tin cÃ¡ nhÃ¢n
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" id="export-charts" checked> Biá»ƒu Ä‘á»“
        </label>
      </div>
      <div style="margin-top:16px;">
        <label style="display:flex;align-items:center;gap:8px;justify-content:center;">
          <input type="checkbox" id="export-all-time"> Xuáº¥t toÃ n bá»™ dá»¯ liá»‡u (khÃ´ng chá»‰ 30 ngÃ y gáº§n nháº¥t)
        </label>
      </div>
    </div>
    <div id="export-feedback" style="margin-top:16px;font-weight:bold;"></div>
  </div>
</section> 